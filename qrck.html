<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N·∫°p ti·ªÅn v√†o t√†i kho·∫£n</title>
    <style>
        body {
            background: #f5f8ff;
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            gap: 32px;
            padding-top: 40px;
        }
        .card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            padding: 32px 28px;
            min-width: 340px;
        }
        .title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
            color: #222b45;
        }
        .subtitle {
            color: #7b8190;
            margin-bottom: 28px;
        }
        .amount-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 18px;
        }
        .amount-btn {
            background: #f5f8ff;
            border: 1.5px solid #e0e7ff;
            border-radius: 8px;
            padding: 16px 0;
            font-size: 1.1rem;
            font-weight: 500;
            color: #222b45;
            cursor: pointer;
            transition: border 0.2s, background 0.2s;
        }
        .amount-btn.selected {
            border: 2px solid #4f8cff;
            background: #eaf2ff;
            color: #2563eb;
        }
        .other-amount {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 18px;
        }
        .other-amount input[type="checkbox"] {
            accent-color: #4f8cff;
        }
        .other-amount label {
            color: #222b45;
            font-size: 1rem;
        }
        .input-amount {
            width: 100%;
            padding: 12px;
            border: 1.5px solid #e0e7ff;
            border-radius: 8px;
            font-size: 1.1rem;
            margin-bottom: 18px;
            outline: none;
            transition: border 0.2s;
        }
        .input-amount:focus {
            border: 2px solid #4f8cff;
        }
        .confirm-btn {
            width: 100%;
            padding: 14px 0;
            background: #4f8cff;
            color: #fff;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .confirm-btn:disabled {
            background: #b3c6ff;
            cursor: not-allowed;
        }
        .instructions {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            padding: 28px 24px;
            min-width: 320px;
        }
        .instructions-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .instructions-list {
            color: #222b45;
            font-size: 1rem;
            padding-left: 20px;
        }
        .instructions-list li {
            margin-bottom: 8px;
        }
        @media (max-width: 800px) {
            .container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
        }
        .vietqr-img {
            width: 250px;
            height: 300px;
            border-radius: 16px;
            box-shadow: 0 4px 16px #0002;
            border: 2.5px solid #e0e7ff;
            background: #fff;
            margin: 0 auto 10px auto;
            display: block;
            transition: box-shadow 0.2s, border 0.2s;
        }
        .vietqr-img:hover {
            box-shadow: 0 8px 24px #0003;
            border: 2.5px solid #4f8cff;
        }
        @keyframes popSuccess {
            0% { transform: scale(0.7); opacity: 0; }
            80% { transform: scale(1.08); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.18); }
        }
    </style>
</head>
<body>
    <div style="padding: 32px 0 0 32px;">
        <span style="font-size: 1.3rem; cursor: pointer; color: #7b8190;" onclick="window.location.href='index.html'">&#8592;</span>
    </div>
    <div class="container" id="depositForm">
        <div class="card">
            <div class="title">N·∫°p ti·ªÅn v√†o t√†i kho·∫£n</div>
            <div class="subtitle">Ch·ªçn s·ªë ti·ªÅn b·∫°n mu·ªën n·∫°p v√†o t√†i kho·∫£n</div>
            <div class="amount-options">
                <button class="amount-btn" onclick="selectAmount(59000)">59.000 ƒë</button>
                <button class="amount-btn" onclick="selectAmount(59900)">59.900 ƒë</button>
                <button class="amount-btn" onclick="selectAmount(59990)">59.990 ƒë</button>
                <button class="amount-btn" onclick="selectAmount(59999)">59.999 ƒë</button>
            </div>
            <div class="other-amount">
                <input type="checkbox" id="otherAmountCheck" onchange="toggleOtherAmount()">
                <label for="otherAmountCheck">Ho·∫∑c nh·∫≠p s·ªë ti·ªÅn kh√°c</label>
            </div>
            <div style="color:#d32f2f;font-size:0.98rem;margin-bottom:10px;font-weight:500;">Ch·ªâ n·∫°p t·ª´ 50.000ƒë tr·ªü l√™n m·ªõi t·∫°o ƒë∆∞·ª£c m√£ </div>
            <input type="number" id="otherAmountInput" class="input-amount" placeholder="Nh·∫≠p s·ªë ti·ªÅn" min="50000" disabled oninput="inputOtherAmount()">
            <button class="confirm-btn" id="confirmBtn" disabled onclick="showPayment()">X√°c nh·∫≠n n·∫°p 0 ƒë &#8594;</button>
        </div>
        <div class="instructions">
            <div class="instructions-title">
                <span style="font-size: 1.3rem;">&#128337;</span>
                Ch√∫ √ù 
            </div>
            <ol class="instructions-list">
                <li>N·ªôi dung chuy·ªÉn kho·∫£n l√† m√£ t·∫°o </li>
                <li>Sau khi n·∫°p ti·ªÅn, b·∫°n vui l√≤ng ƒë·ª£i t√¥i ƒë·ªÉ ƒë∆∞·ª£c c·∫≠p nh·∫≠p m√£ t·∫°o</li>
                <li>T√¥i s·∫Ω c·∫≠p nh·∫≠t m√£ t·∫°o c·ªßa b·∫°n trong v√≤ng 1 ph√∫t</li>
                <li>N·∫øu b·∫°n kh√¥ng nh·∫≠n ƒë∆∞·ª£c t√†i kho·∫£n, vui l√≤ng li√™n h·ªá v·ªõi t√¥i</li>
            </ol>
        </div>
    </div>
    <!-- Giao di·ªán x√°c nh·∫≠n thanh to√°n -->
    <div class="container" id="paymentSection" style="display:none;">
        <div class="card" style="min-width:350px;max-width:400px;">
            <div style="font-weight:600;font-size:1.1rem;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=40x40&data=techcombank" alt="qr" style="width:24px;height:24px;"> M√£ QR thanh to√°n
            </div>
            <div style="background:#fff7ea;border:1px solid #ffe0b2;color:#e67c00;padding:10px 14px;border-radius:8px;font-size:1rem;display:flex;align-items:center;gap:8px;margin-bottom:12px;">
                <span style="font-size:1.2rem;">&#9200;</span> Th·ªùi gian c√≤n l·∫°i: <span id="timer">10:00</span>
            </div>
            <div id="qrLoading" style="display:none;text-align:center;margin-bottom:10px;">
                <span style="font-size:2rem;">‚è≥</span> ƒêang t·∫£i m√£ QR...
            </div>
            <img id="vietqrImg" src="" alt="QR thanh to√°n" class="vietqr-img" style="display:none;">
            <div style="text-align:center;margin-bottom:12px;">
                <div style="margin-top:8px;font-size:1.1rem;font-weight:600;color:#d32f2f;">VIETQR</div>
                <div style="color:#7b8190;font-size:0.95rem;">napas 247 &nbsp; | &nbsp; <b>Techcombank</b></div>
                <div style="color:#222b45;font-size:0.95rem;">CAO VAN NAM<br>2005838699</div>
                <div style="color:#7b8190;font-size:0.95rem;">S·ªë ti·ªÅn: <span id="payAmount">200.000 VND</span></div>
            </div>
            <button style="width:100%;background:#f5f8ff;border:none;padding:10px 0;border-radius:8px;color:#2563eb;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;font-size:1rem;" onclick="copyPaymentInfo()">
                <span style="font-size:1.2rem;">&#128203;</span> Sao ch√©p th√¥ng tin
            </button>
        </div>
        <div class="card" style="min-width:350px;max-width:400px;">
            <div style="font-weight:600;font-size:1.1rem;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
                <span style="font-size:1.2rem;">&#128179;</span> Th√¥ng tin chuy·ªÉn kho·∫£n
            </div>
            <div style="margin-bottom:10px;display:flex;align-items:center;gap:8px;">
                <span style="font-size:1.1rem;">üè¶</span> Ng√¢n h√†ng: <b style="margin-left:auto;">Techcombank</b>
            </div>
            <div style="margin-bottom:10px;display:flex;align-items:center;gap:8px;">
                <span style="font-size:1.1rem;">#Ô∏è‚É£</span> S·ªë t√†i kho·∫£n: <b style="margin-left:auto;">2005838699</b>
            </div>
            <div style="margin-bottom:10px;display:flex;align-items:center;gap:8px;">
                <span style="font-size:1.1rem;">üë§</span> Ch·ªß t√†i kho·∫£n: <b style="margin-left:auto;">CAO VAN NAM</b>
            </div>
            <div style="margin-bottom:10px;display:flex;align-items:center;gap:8px;">
                <span style="font-size:1.1rem;">üí∞</span> S·ªë ti·ªÅn: <b style="margin-left:auto;" id="payAmount2">200.000 ƒë</b>
            </div>
            <div style="margin-bottom:16px;display:flex;align-items:center;gap:8px;">
                <span style="font-size:1.1rem;">üìù</span> N·ªôi dung CK: <b style="margin-left:auto;" id="payNote">hoangnam' + (Math.floor(Math.random()*900)+100)</b>
            </div>
            <button style="width:100%;background:#e53935;color:#fff;padding:14px 0;border:none;border-radius:8px;font-size:1.1rem;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;" onclick="cancelPayment()">
                <span style="font-size:1.2rem;">&#9888;</span> H·ªßy giao d·ªãch
            </button>
        </div>
    </div>
    <div id="paymentGuide" style="max-width:420px;margin:32px auto 0 auto;display:none;">
        <div class="instructions">
            <div class="instructions-title">
                <span style="font-size: 1.3rem;">&#128337;</span>
                Ch√∫ √ù 
            </div>
            <ol class="instructions-list">
                <li>N·ªôi dung chuy·ªÉn kho·∫£n l√† m√£ t·∫°o </li>
                <li>Sau khi n·∫°p ti·ªÅn, b·∫°n vui l√≤ng ƒë·ª£i t√¥i ƒë·ªÉ ƒë∆∞·ª£c c·∫≠p nh·∫≠p m√£ t·∫°o</li>
                <li>T√¥i s·∫Ω c·∫≠p nh·∫≠t m√£ t·∫°o c·ªßa b·∫°n trong v√≤ng 1 ph√∫t</li>
                <li>N·∫øu b·∫°n kh√¥ng nh·∫≠n ƒë∆∞·ª£c t√†i kho·∫£n, vui l√≤ng li√™n h·ªá v·ªõi t√¥i</li>
            </ol>
        </div>
    </div>
    <div id="successAlert" style="display:none;max-width:520px;margin:32px auto 0 auto;background:#e6ffed;border:2.5px solid #42b72a;color:#1b5e20;padding:28px 24px 24px 24px;border-radius:16px;font-size:1.35rem;font-weight:700;text-align:center;box-shadow:0 8px 32px #42b72a22;z-index:9999;position:fixed;left:0;right:0;top:18vh;animation:popSuccess 0.5s cubic-bezier(.68,-0.55,.27,1.55);">
        <span style="font-size:2.2rem;vertical-align:middle;animation:pulse 1.2s infinite alternate;">&#127881;</span><br>
        <span style="display:inline-block;margin-top:10px;">Thanh to√°n th√†nh c√¥ng!<br>M√£ c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c admin x√°c nh·∫≠n.<br><span style='font-size:1.1rem;font-weight:400;'>B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn v·ªÅ trang ch·ªß sau <span id='successCountdown'>10</span> gi√¢y.</span></span>
    </div>
    <script>
        let selectedAmount = 0;
        function selectAmount(amount) {
            if (document.getElementById('otherAmountCheck').checked) return;
            selectedAmount = amount;
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent.replace(/\D/g, '') == amount) {
                    btn.classList.add('selected');
                }
            });
            updateConfirmBtn();
        }
        function toggleOtherAmount() {
            const checked = document.getElementById('otherAmountCheck').checked;
            document.getElementById('otherAmountInput').disabled = !checked;
            if (checked) {
                selectedAmount = 0;
                document.querySelectorAll('.amount-btn').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('otherAmountInput').focus();
            } else {
                document.getElementById('otherAmountInput').value = '';
            }
            updateConfirmBtn();
        }
        function inputOtherAmount() {
            if (!document.getElementById('otherAmountCheck').checked) return;
            const val = parseInt(document.getElementById('otherAmountInput').value) || 0;
            selectedAmount = val;
            updateConfirmBtn();
        }
        function updateConfirmBtn() {
            const btn = document.getElementById('confirmBtn');
            btn.textContent = `X√°c nh·∫≠n n·∫°p ${selectedAmount.toLocaleString('vi-VN')} ƒë ‚Üí`;
            btn.disabled = selectedAmount < 50000;
        }
        let checkInterval;
        let redirectTimeout;
        let countdownInterval;
        // H√†m ki·ªÉm tra m√£ ƒë√£ ƒë∆∞·ª£c admin t·∫°o ch∆∞a
        async function checkCodeCreated() {
            const payNote = document.getElementById('payNote').textContent;
            try {
                const response = await fetch('https://lkhoangnam.onrender.com/api/codelink');
                if (response.ok) {
                    const codes = await response.json();
                    const found = codes.find(entry => entry.code === payNote);
                    if (found) {
                        document.getElementById('successAlert').style.display = 'block';
                        clearInterval(checkInterval);
                        let seconds = 10;
                        document.getElementById('successCountdown').textContent = seconds;
                        countdownInterval = setInterval(() => {
                            seconds--;
                            document.getElementById('successCountdown').textContent = seconds;
                            if (seconds <= 0) {
                                clearInterval(countdownInterval);
                            }
                        }, 1000);
                        redirectTimeout = setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 10000);
                    } else {
                        document.getElementById('successAlert').style.display = 'none';
                        clearInterval(countdownInterval);
                    }
                }
            } catch (e) {
                // Kh√¥ng l√†m g√¨ n·∫øu l·ªói
            }
        }
        // Hi·ªán giao di·ªán thanh to√°n, ·∫©n form ch·ªçn s·ªë ti·ªÅn
        function showPayment() {
            document.getElementById('depositForm').style.display = 'none';
            document.getElementById('paymentSection').style.display = 'flex';
            document.getElementById('paymentGuide').style.display = 'block';
            // C·∫≠p nh·∫≠t s·ªë ti·ªÅn
            document.getElementById('payAmount').textContent = selectedAmount.toLocaleString('vi-VN') + ' VND';
            document.getElementById('payAmount2').textContent = selectedAmount.toLocaleString('vi-VN') + ' ƒë';
            // Sinh n·ªôi dung chuy·ªÉn kho·∫£n ng·∫´u nhi√™n
            const random3 = Math.floor(Math.random()*900)+100;
            const payNote = 'hoangnam' + random3;
            document.getElementById('payNote').textContent = payNote;
            // T·∫°o link QR ƒë·ªông VietQR
            const bankId = 'techcombank';
            const accountNo = '2005838699';
            const template = 'compact2';
            const accountName = encodeURIComponent('CAO VAN NAM');
            const amount = selectedAmount;
            const addInfo = encodeURIComponent(payNote);
            const qrUrl = `https://img.vietqr.io/image/${bankId}-${accountNo}-${template}.png?amount=${amount}&addInfo=${addInfo}&accountName=${accountName}`;
            // Hi·ªán loading, ·∫©n QR
            document.getElementById('qrLoading').style.display = 'block';
            const qrImg = document.getElementById('vietqrImg');
            qrImg.style.display = 'none';
            qrImg.onload = function() {
                document.getElementById('qrLoading').style.display = 'none';
                qrImg.style.display = 'block';
            };
            qrImg.onerror = function() {
                document.getElementById('qrLoading').innerHTML = '<span style="color:#d32f2f;font-size:1.1rem;">Kh√¥ng t·∫£i ƒë∆∞·ª£c m√£ QR. Vui l√≤ng th·ª≠ l·∫°i!</span>';
            };
            qrImg.src = qrUrl;
            // Reset v√† b·∫Øt ƒë·∫ßu l·∫°i timer
            startTimer(10*60);
            // B·∫Øt ƒë·∫ßu ki·ªÉm tra m√£ m·ªói 3 gi√¢y
            checkCodeCreated();
            clearInterval(checkInterval);
            clearTimeout(redirectTimeout);
            clearInterval(countdownInterval);
            checkInterval = setInterval(checkCodeCreated, 3000);
        }
        function cancelPayment() {
            document.getElementById('depositForm').style.display = 'flex';
            document.getElementById('paymentSection').style.display = 'none';
            document.getElementById('paymentGuide').style.display = 'none';
            clearInterval(checkInterval);
            clearTimeout(redirectTimeout);
            clearInterval(countdownInterval);
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('qrLoading').style.display = 'none';
            document.getElementById('vietqrImg').style.display = '';
        }
        // Sao ch√©p th√¥ng tin chuy·ªÉn kho·∫£n
        function copyPaymentInfo() {
            const info = `Ng√¢n h√†ng: Techcombank\nS·ªë t√†i kho·∫£n: 2005838699\nCh·ªß t√†i kho·∫£n: CAO VAN NAM\nS·ªë ti·ªÅn: ${selectedAmount.toLocaleString('vi-VN')} ƒë\nN·ªôi dung CK: ${document.getElementById('payNote').textContent}`;
            navigator.clipboard.writeText(info);
            alert('ƒê√£ sao ch√©p th√¥ng tin!');
        }
        // ƒê·∫øm ng∆∞·ª£c th·ªùi gian
        let timerInterval;
        function startTimer(duration) {
            clearInterval(timerInterval);
            let time = duration;
            function update() {
                const min = Math.floor(time/60);
                const sec = time%60;
                document.getElementById('timer').textContent = `${min}:${sec.toString().padStart(2,'0')}`;
                if (time > 0) time--;
                else clearInterval(timerInterval);
            }
            update();
            timerInterval = setInterval(update, 1000);
        }
    </script>
</body>
</html>
